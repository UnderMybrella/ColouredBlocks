package org.abimon.mods.minecraft.colouredBlocks;

import java.io.File;
import java.util.HashMap;

import org.json.simple.JSONObject;

import net.minecraft.block.Block;
import net.minecraft.creativetab.CreativeTabs;
import net.minecraft.init.Blocks;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraft.item.ItemBlockWithMetadata;
import net.minecraft.item.ItemStack;
import net.minecraft.item.crafting.CraftingManager;
import net.minecraftforge.client.MinecraftForgeClient;
import cpw.mods.fml.client.registry.RenderingRegistry;
import cpw.mods.fml.common.Mod;
import cpw.mods.fml.common.Mod.EventHandler;
import cpw.mods.fml.common.event.FMLInitializationEvent;
import cpw.mods.fml.common.registry.GameRegistry;
import cpw.mods.fml.relauncher.Side;
import cpw.mods.fml.relauncher.SideOnly;

@Mod(modid = ColouredBlocks.MODID, version = ColouredBlocks.VERSION)
public class ColouredBlocks
{
    public static final String MODID = "colouredblocks";
    public static final String VERSION = "1.0";
    
    public static final CreativeTabs tabColoured  = new CreativeTabs(CreativeTabs.getNextID(), MODID + ":creativeTab")
    {
        @SideOnly(Side.CLIENT)
        public Item getTabIconItem()
        {
            return ColouredBlocks.crayon;
        }
    };
    
    public static Item crayon = new ItemCrayon().setCreativeTab(tabColoured).setUnlocalizedName(MODID + ":crayon");
    public static Block colouredBlock = new BlockColoured();
    public static Block dyeBlock = new BlockDye().setCreativeTab(tabColoured);
    public static Item colouredPlacer = new ItemColouredPlacer().setCreativeTab(tabColoured).setHasSubtypes(true);
    public static Item colouringEssense = new ItemColouringEssense().setCreativeTab(tabColoured).setUnlocalizedName(MODID + ":essense");
    public static int RENDER = 33;
    
    public static final HashMap<String, Integer[]> itemstackToColourAdditions = new HashMap<String, Integer[]>();
    
    @EventHandler
    public void init(FMLInitializationEvent event)
    {
    	GameRegistry.registerItem(crayon, "crayon");
    	GameRegistry.registerBlock(colouredBlock, "colouredBlock");
    	GameRegistry.registerTileEntity(TileEntityColoured.class, "teColoured");
    	GameRegistry.registerItem(colouredPlacer, "colouredPlacer");
    	GameRegistry.registerItem(colouringEssense, "essense");
    	GameRegistry.registerBlock(dyeBlock, ItemBlockDye.class, "dyeBlock");
    	MinecraftForgeClient.registerItemRenderer(colouredPlacer, new PlacerRender());
    	RENDER = RenderingRegistry.getNextAvailableRenderId();
    	RenderingRegistry.registerBlockHandler(RENDER, new ColouredRenderer());
    	
    	File config = new File("config" + File.separatorChar + "ColouredBlocks.json");
    	if(!config.exists())
    	{
    		JSONObject json = new JSONObject();
    		json.put("enableRareNames", true);
    	}
    	
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 1), 8, 0, 0);
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 2), 0, 8, 0);
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 4), 0, 0, 8);
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 14), 1, 0, 0);
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 10), 0, 1, 0);
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 6), 0, 0, 1);
    	registerItemstackWithColouring(new ItemStack(Items.dye, 1, 0), 0, 0, 0);
    	CraftingManager.getInstance().getRecipeList().add(new ColouredRecipes());
    	for(int i = 0; i < 16; i++)
    		CraftingManager.getInstance().addRecipe(new ItemStack(dyeBlock, 1, i), new Object[]{"DDD", "DQD", "DDD", 'D', new ItemStack(Items.dye, 1, i), 'Q', Blocks.quartz_block});
    }
    
    public static String outputNicely(JSONObject json)
	{
		String jString = json.toJSONString();
		String nicely = "";
		int level = 0;
		boolean inStatementSingle = false;
		boolean inStatementDouble = false;
		for(char c : jString.toCharArray())
		{
			if(c == '"')
				inStatementDouble = !inStatementDouble;
			if(c == '\'')
				inStatementSingle = !inStatementSingle;
			if(inStatementSingle || inStatementDouble)
			{
				nicely += c;
				continue;
			}
			if(c == '{')
				level++;
			if(c == '}')
			{
				level--;
				nicely += "\n";
				for(int i = 0; i < level; i++)
					nicely += "\t";
			}
			nicely += c;
			if(c == '{'|| c == ',')
			{
				nicely += "\n";

				for(int i = 0; i < level; i++)
					nicely += "\t";
			}
		}
		return nicely;
	}
    
    public static void registerItemstackWithColouring(ItemStack item, int redAddition, int greenAddition, int blueAddition)
    {
    	if(item.getItem() instanceof IColourable)
    		return;
    	itemstackToColourAdditions.put(represent(item), new Integer[]{redAddition, greenAddition, blueAddition});
    }
    
    public static String represent(ItemStack item)
    {
    	String s = "Name:" + item.getDisplayName() + ", Damage:" + item.getItemDamage() + ", NBT:" + item.getTagCompound();
    	return s;
    }
}
