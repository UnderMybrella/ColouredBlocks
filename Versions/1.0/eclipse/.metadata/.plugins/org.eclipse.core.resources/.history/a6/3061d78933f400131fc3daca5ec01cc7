package org.abimon.mods.minecraft.dnc;

import java.util.Arrays;

import net.minecraft.command.CommandBase;
import net.minecraft.command.CommandException;
import net.minecraft.command.ICommandSender;
import net.minecraft.command.PlayerNotFoundException;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.entity.player.EntityPlayerMP;
import net.minecraft.item.ItemEditableBook;
import net.minecraft.item.ItemStack;
import net.minecraft.item.ItemWritableBook;
import net.minecraft.nbt.NBTBase;
import net.minecraft.nbt.NBTTagList;
import net.minecraft.server.MinecraftServer;

public class CommandUseCommand extends CommandBase {

	@Override
	public String getCommandName() {
		return "useCommand";
	}

	@Override
	public String getCommandUsage(ICommandSender var1) {
		return "/useCommand";
	}

    public int getRequiredPermissionLevel()
	{
		return 2;
	}

	@Override
	public void processCommand(ICommandSender var1, String[] var2) {
		EntityPlayerMP player = getPlayer(var1, var2[0]);
		
		ItemStack item = player.getHeldItem();
		if(item == null)
			throw new CommandException("Player " + player.getCommandSenderName() + " is not holding a writable book!");
		if(item.getItem() instanceof ItemWritableBook)
		{
			try
			{
				String command = joinPages(item.getTagCompound().getTag("pages"));
				System.out.println(command);
				MinecraftServer.getServer().getCommandManager().executeCommand(player, command);
			}
			catch(CommandException th)
			{
				throw th;
			}
		}
		else if(item.getTagCompound().hasKey("UseCommand"))
		{
			
		}
	}

	private String joinPages(NBTBase tag) {
		if(tag instanceof NBTTagList)
		{
			String joined = "";
			NBTTagList list = (NBTTagList) tag;
			for(int i = 0; i < list.tagCount(); i++)
				joined += list.getStringTagAt(i);
			return joined;
		}
		return null;
	}

}
