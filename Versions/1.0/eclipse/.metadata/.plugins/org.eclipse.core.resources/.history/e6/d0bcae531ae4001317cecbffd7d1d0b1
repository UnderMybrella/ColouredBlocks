package org.abimon.mods.minecraft.dnc;

import java.util.HashMap;

import net.minecraft.client.Minecraft;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.entity.player.InventoryPlayer;
import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import net.minecraft.potion.Potion;
import net.minecraft.potion.PotionEffect;
import net.minecraft.server.MinecraftServer;
import net.minecraft.server.management.ServerConfigurationManager;
import net.minecraft.world.WorldServer;

public class WeightThread extends Thread 
{
	public static WeightMap map = new WeightMap();

	public void run()
	{	
		try
		{
			Thread.sleep(5000);
			System.out.println("STARTING");
			MinecraftServer server = MinecraftServer.getServer();
			while(server == null)
			{
				Thread.sleep(1000);
				server = MinecraftServer.getServer();
			}
			ServerConfigurationManager scm = server.getConfigurationManager();
			while(scm == null)
			{
				Thread.sleep(1000);
				scm = server.getConfigurationManager();
			}
			int players = 0;
			while(true)
			{
				players = 0;
				try
				{
					System.out.println("Loop");
					for(String s : server.getAllUsernames())
					{
						Object o = scm.getPlayerForUsername(s);
						System.out.println(o);
						if(o instanceof EntityPlayer)
						{
							EntityPlayer player = (EntityPlayer) o;
							InventoryPlayer inv = player.inventory;

							int weight = 0;

							for(ItemStack i : inv.mainInventory)
								weight += map.getWeightForObject(i);

							if(weight > 100)
								player.addPotionEffect(new PotionEffect(Potion.moveSlowdown.id, 10000, 10));
							System.out.println(weight);
						}
						else
							System.out.println(o.getClass());
					}
					Thread.sleep(50000);
				}
				catch(Throwable th){
					System.err.println(th);
				}
			}
		}
		catch(Throwable the){
			run();
		}
	}
}
